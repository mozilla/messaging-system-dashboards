---
# Redash dashboard template for Messaging System.
#
#
#                    Dashboard Layout
# ---------------------------------------------------------------
#
#
#   Onboarding DAU
#
#
# ---------------------------------------------------------------
#
#
#   CFR DAU
#
#
# ---------------------------------------------------------------
#
#
#   What's New Panel DAU
#
#
# ---------------------------------------------------------------
#
#
#   Snippets DAU
#
#
# ---------------------------------------------------------------


title: "Messaging System: Daily Users"
charts:
  - title: "Onboarding Daily Users"
    type: line
    full_width: True
    query: |
      SELECT submission_date AS date,
             "ALL" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.onboarding_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
      GROUP BY 1
      UNION ALL
      SELECT submission_date AS date,
             "TIER-1" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.onboarding_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
        AND country IN ('US', 'GB', 'DE', 'FR', 'CA')
      GROUP BY 1
    x_axis: date
    y_axis: smoothed_dau
    group_by: geo
  - title: "CFR Daily Users"
    type: line
    full_width: True
    query: |
      SELECT submission_date AS date,
             "ALL" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.cfr_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
      GROUP BY 1
      UNION ALL
      SELECT submission_date AS date,
             "TIER-1" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.cfr_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
        AND country IN ('US', 'GB', 'DE', 'FR', 'CA')
      GROUP BY 1
    x_axis: date
    y_axis: smoothed_dau
    group_by: geo
  - title: "What's New Panel Daily Users"
    type: line
    full_width: True
    query: |
      SELECT submission_date AS date,
             "ALL" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(whats_new_dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.cfr_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
      GROUP BY 1
      UNION ALL
      SELECT submission_date AS date,
             "TIER-1" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(whats_new_dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.cfr_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
      AND country IN ('US', 'GB', 'DE', 'FR', 'CA')
      GROUP BY 1
    x_axis: date
    y_axis: smoothed_dau
    group_by: geo
  - title: "Snippets Daily Users"
    type: line
    full_width: True
    query: |
      SELECT submission_date AS date,
             "ALL" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.snippets_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
      GROUP BY 1
      UNION ALL
      SELECT submission_date AS date,
             "TIER-1" AS geo,
             sum(dau) AS dau,
             CAST(
                AVG(SUM(dau)) OVER (ORDER BY submission_date ROWS 6 PRECEDING)
             AS INT64) AS smoothed_dau
      FROM messaging_system.snippets_exact_mau28_by_dimensions
      WHERE release_channel = 'release'
        AND country IN ('US', 'GB', 'DE', 'FR', 'CA')
      GROUP BY 1
